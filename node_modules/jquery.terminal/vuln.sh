#!/bin/bash

set -x
diff=`git diff --unified=0 ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} | grep -E "^[+]" | grep -Ev '^(--- a/|\+\+\+ b/)'`
unicode_diff=`echo -n "${diff}" | grep -oP "[^\x00-\x7F]*"`
unicode_grep_exit_code=$?
echo "${unicode_diff}"

unicode_diff_hexdump=`echo -n "${unicode_diff}" | hd`
echo "${unicode_diff_hexdump}"

# did we select any unicode characters?
if [[ "${unicode_diff_hexdump}" == "" ]]; then
  # we didn't find any unicode characters
  human_result="INFO: No unicode characters found in PR's commits"
  echo "${human_result}"

else
  # we found at least 1 unicode character
  human_result="^^ WARNING: Unicode characters found in diff!"
  echo "${human_result}"
  echo "${diff}"

fi